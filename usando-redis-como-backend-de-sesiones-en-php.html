<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Israel Fermín Montilla" />
        <meta name="copyright" content="Israel Fermín Montilla" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="desarrollo, web, sesiones, redis, php, Blog, " />

<meta property="og:title" content="Usando Redis como backend de sesiones en php "/>
<meta property="og:url" content="http://localhost:8000/usando-redis-como-backend-de-sesiones-en-php.html" />
<meta property="og:description" content="Bueno, sí, leyeron bien el título, luego de años me tocó trabajar de nuevo con php en la oficina, dejen el escándalo. Siendo sincero, las cosas parecieran haber mejorado mucho desde la última vez que hice (o traté de hacer) algo con php, era php 4.algo en aquel momento ..." />
<meta property="og:site_name" content="@#$%_" />
<meta property="og:article:author" content="Israel Fermín Montilla" />
<meta property="og:article:published_time" content="2014-10-19T12:30:00" />
<meta name="twitter:title" content="Usando Redis como backend de sesiones en php ">
<meta name="twitter:description" content="Bueno, sí, leyeron bien el título, luego de años me tocó trabajar de nuevo con php en la oficina, dejen el escándalo. Siendo sincero, las cosas parecieran haber mejorado mucho desde la última vez que hice (o traté de hacer) algo con php, era php 4.algo en aquel momento ...">

        <title>Usando Redis como backend de sesiones en php  · @#$%_
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/custom.css" media="screen">
        <link href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="@#$%_ - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-55459920-1', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://localhost:8000/"><span class=site-name>@#$%_</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://localhost:8000">Home</a></li>
                            <li ><a href="http://localhost:8000/categories.html">Categories</a></li>
                            <li ><a href="http://localhost:8000/tags.html">Tags</a></li>
                            <li ><a href="http://localhost:8000/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://localhost:8000/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://localhost:8000/usando-redis-como-backend-de-sesiones-en-php.html"> Usando Redis como backend de sesiones en php  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <p>Bueno, sí, leyeron bien el título, luego de años me tocó
trabajar de nuevo con php en la oficina, dejen el escándalo.</p>
<p>Siendo sincero, las cosas parecieran haber mejorado mucho desde
la última vez que hice (o traté de hacer) algo con php, era php
4.algo en aquel momento, jugaba con <em>Symfony</em> y fue una desgracia
que no se la deseo ni a mi peor enemigo.</p>
<p>Luego, más recientemente jugué con <em>Yii</em>, un framework para desarrollo
web con php que me pareció bastante bueno y es una alternativa
que le recomiendo a todo aquel que no tenga más remedio que
desarrollar usando este lenguaje, algunos me dicen que pruebe
<em>Lavarel</em> y seguramente me cambie a php, pero dudo mucho que
algo me atrape tanto como <em>Python</em>, sin importar el framework,
incluso <em>Web2Py</em> tiene muchas cosas rescatables.</p>
<p>Bueno, manos a la obra:</p>
<div class="section" id="la-historia">
<h2>La historia:</h2>
<p>En la oficina están en una onda de <em>intercambiar código</em> con nuestros
aliados comerciales o &quot;páginas hermanas&quot;, el problema es que nosotros
desarrollamos en <em>Python</em> + <em>django</em> y a veces <em>bottle</em> y todos los demás
en php.</p>
<p>Este proyecto en particular, fue desarrollado con un framework hecho en
casa en php y es usado como una librería para autenticación utilizando
servicios de 3eros, es decir, <em>OAuth</em>. Esto en un mundo ideal, donde todo
lo programas con php y puedes simplemente hacer:</p>
<pre class="code php literal-block">
<span class="x">use project\module\submodule\file;</span>
</pre>
<p>y todo bien.</p>
</div>
<div class="section" id="el-problema">
<h2>El problema:</h2>
<p>Obviamente, no podemos importar código php en nuestro proyecto en <em>Python</em>,
entonces, la solución fue simplemente, adaptar la librería provista
por la otra gente para usarla como un servicio, la cosa salió bastante bien,
pero al momento de poner todo en producción, nos dimos cuenta de algo.</p>
<p>Se desplegaron dos instancias de este servicio detrás de un balanceador de carga,
para autenticar usando <em>OAuth</em>, es necesario golpear más de una vez el servicio,
entonces, estando dos (o más) instancias detrás de un balanceador de carga, no
tienes manera de garantizar que quien atiende el primer <em>request</em>, es el mismo
que atiende el segundo.</p>
<p>A esto súmale que se guarda cierta información en la sesión para mantenerla
durante todo el proceso de autenticación y php almacena las variables de sesión
en un archivo local del servidor.</p>
</div>
<div class="section" id="la-solucion">
<h2>La solución:</h2>
<p>Sin pensarlo mucho, la solución es tener <em>algo</em> que todas las instancias
compartan para escribir la información relacionada a las sesiones, puede
ser una base de datos <em>MySQL</em>, un sistema de archivos compartido con <em>NFS</em>,
lo que sea, nosotros optamos por <em>Redis</em> porque es lo más rápido y fácil de
configurar, responde rápido porque mantiene ciertas cosas en memoria y es
difícil que pierda datos, puede pasar, pero igual es información transitoria
que no nos interesa conservar.</p>
<div class="section" id="implementacion">
<h3>Implementación:</h3>
<p>Luego de investigar unos minutos, nos dimos cuenta de que no era nada del otro
mundo, simplemente cambiar unos parámetros de configuración en los respectivos
archivos <em>php.ini</em>, instalar un par de paquetes y listo.</p>
<div class="section" id="instalacion-de-paquetes">
<h4>Instalación de paquetes:</h4>
<p>Descargamos <a class="reference external" href="https://github.com/nicolasff/phpredis">php-redis</a></p>
<pre class="code literal-block">
sudo aptitude install php5-dev
cd php_redis/
sudo phpize
sudo ./configure
sudo make
sudo make install
</pre>
</div>
<div class="section" id="php-ini">
<h4>php.ini:</h4>
<p>Simplemente debemos modificar las siguientes líneas:</p>
<pre class="code literal-block">
extension=redis.so
[Session]
session.save_handler=redis
session.save_path=&quot;tcp://localhost:6379&quot;
</pre>
<p>El <em>save_path</em> debe tener la IP y el Puerto donde nuestra instancia de
redis estará escuchando.</p>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusión:</h2>
<p>Ciertamente las cosas han mejorado sólo un poco en php desde la última vez que
lo usé para algo más que un proyecto de juguete. Sin embargo no me veo programando
en php a menos que sea estrictamente necesario por las características o restricciones
de un proyecto en particular.</p>
<p>Respecto al servicio de autenticación, ya está en producción, pareciera estar funcionando
bastante bien, sin embargo hay muchas cosas con las que no estamos contentos, seguramente
terminemos cambiándolo por una versión 2.0, seguramente en <em>Python</em> y desarrollado por
nosotros pero, al menos por ahora, funciona y hace el trabajo.</p>
</div>

            <section>
    <p id="post-share-links">
    Compártelo
    <a href="http://twitter.com/home?status=Usando%20Redis%20como%20backend%20de%20sesiones%20en%20php%20http%3A//localhost%3A8000/usando-redis-como-backend-de-sesiones-en-php.html" target="_blank" title="Share on Twitter">Twitter</a>
    ❄
    <a href="http://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A//localhost%3A8000/usando-redis-como-backend-de-sesiones-en-php.html" target="_blank" title="Share on Facebook">Facebook</a>
    ❄
    <a href="https://plus.google.com/share?url=http%3A//localhost%3A8000/usando-redis-como-backend-de-sesiones-en-php.html" target="_blank" title="Share on Google Plus">Google+</a>
    ❄
    <a href="mailto:?subject=Usando%20Redis%20como%20backend%20de%20sesiones%20en%20php&amp;body=http%3A//localhost%3A8000/usando-redis-como-backend-de-sesiones-en-php.html" target="_blank" title="Share via Email">Email</a>
    </p>
</section>

            <section>
<p id="comment-message">Preguntas, comentatios, chistes o sugerencias, por acá. </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://localhost:8000/usando-redis-como-backend-de-sesiones-en-php.html#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'iferminmblog';
        var disqus_identifier = 'http://localhost:8000/usando-redis-como-backend-de-sesiones-en-php.html';
    var disqus_url = 'http://localhost:8000/usando-redis-como-backend-de-sesiones-en-php.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2014-10-19T12:30:00">oct 19, 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="http://localhost:8000/categories.html#blog-ref">Blog</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://localhost:8000/tags.html#desarrollo-ref">desarrollo
                    <span>2</span>
</a></li>
                <li><a href="http://localhost:8000/tags.html#php-ref">php
                    <span>1</span>
</a></li>
                <li><a href="http://localhost:8000/tags.html#redis-ref">redis
                    <span>1</span>
</a></li>
                <li><a href="http://localhost:8000/tags.html#sesiones-ref">sesiones
                    <span>1</span>
</a></li>
                <li><a href="http://localhost:8000/tags.html#web-ref">web
                    <span>2</span>
</a></li>
            </ul>
<h4>Sígueme!</h4>
    <a href="http://twitter.com/iferminm" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="http://www.linkedin.com/profile/view?id=66587805&amp;trk=tab_pro" title="My LinkedIn Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-linkedin sidebar-social-links"></i></a>
    <a href="https://github.com/iferminm" title="My GitHub Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="mailto:iferminmontilla@gmail.com" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
<!-- Begin MailChimp Signup Form -->
<div id="mc-embed-signup">
<form action="http://iferminmontilla.us11.list-manage.com/subscribe/post?u=0d4b15ef6a90baa460d821dbc&id=8b51ac80b2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
<h4>Suscríbete</h4>
<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Pasa tu correo pues..." required>
<div class="clear"><input type="submit" value="Ok, pero sin spam" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
</form>
</div>
<!--End mc_embed_signup-->
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'iferminmblog';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>