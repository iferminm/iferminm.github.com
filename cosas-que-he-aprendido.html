<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cosas que he aprendido: - Israel Fermín Montilla</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="http://iferminmontilla.com/theme/css/iferminm.css">
</head>
<body>
    <div id="header">
        <div id="header-logo-holder">
            <a href="http://iferminmontilla.com"><img src="http://iferminmontilla.com/theme/images/header-logo.png" alt=""></a>    
        </div>
        <div id="logo-text">
            <span><b>Israel Fermín Montilla</b></span>
            <span>Software Engineer</span>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-2">
            <div class="collapse navbar-collapse" id="nav-elements">
                <ul class="nav nav-pills nav-stacked">
                    <li class="active"><a href="http://iferminmontilla.com">Blog</a></li>
                </ul>
            </div>
            <div class="under-menu-ad">
                <script src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- Blog under menu -->
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9066997121369275" data-ad-slot="3361083144" data-ad-format="auto"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </div>
        <div class="col-xs-9">
            <div id="main-content" class="ckontainer"> 
<div class="article-header">
    <h1>Cosas que he aprendido:</h1> 
    by <a href="author/israel-fermin-montilla.html">Israel Fermín Montilla</a>
</div>

<p>Luego de algún tiempo desarrollando software, sea para web
o escritorio, uno realmente termina de entender aquello que nos
decían en <em>Algoritmos y Programación I</em> de <strong>Divide y vencerás</strong>,
quizás en la Universidad uno no lo aplica mucho, tienes 8 proyectos
y 14 parciales en una semana y tienes que salir de todo lo más rápido
posible, entonces terminas escribiendo muchísimo terrible, quien sea
inocente, que lance la primera piedra. Incluso a veces en el trabajo
por la presión de los <em>deadlines</em> uno termina tomando atajos para hacer
la cosa funcionar y dejar un comentario de estos que empiezan con <strong>TODO</strong>
o <strong>FIXME</strong> para arreglarlo luego o advertir al resto del equipo que
ese bloque de código debe ser arreglado o podría causar problemas
más adelante.</p>
<p>Lo primero que uno tiende a hacer es separar todo en funciones,
tratar de que cada función que se escribe haga una y sólo una cosa,
sin efectos colaterales, por ejemplo:</p>
<pre class="code python literal-block">
<span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
<p>Esta función, claramente, no hace una cosa, hace dos, escribe un texto
al archivo y luego lo cierra, esto es poco intuitivo, cualquiera llamaría
la función dos veces y, la segunda, seguramente ocurre una excepción, lo ideal
sería:</p>
<ol class="arabic simple">
<li>Renombrar la función a <em>write_to_file_and_close()</em> o...</li>
<li>Mucho mejor, simplemente cerrar el archivo en otra parte.</li>
</ol>
<p>¿Ven?, <strong>divide y vencerás</strong>, nada difícil ¿no?</p>
<p>Luego, conocemos las clases, los objetos y los paquetes (no, no esa clase de
paquetes, no sean mal pensados), entonces, empezamos encapsular entidades en
clases, cuyos objetos actuarán sobre los datos que maneja el programa y cada
clase tendrá una y sólo una tarea específica, esta tarea la cumplirá porque
todos y cada uno de los métodos que escribimos para ella están relacionados
entre sí y están diseñados para trabajar en conjunto para lograr ese objetivo,
es decir, tienen <em>alta cohesión</em>.</p>
<p>Al mismo tiempo, estas clases, la agrupamos en <em>paquetes</em> o <em>módulos</em>, cada
uno de estos, cumple también una tarea específica que no afecta el trabajo de
los demás, es decir, tienen <em>bajo acoplamiento</em>, tenemos, normalmente, un módulo
para acceso a datos, un módulo para la lógica compleja del programa y otro para
interactuar con la <em>Capa 8 de la red</em>, es decir, el usuario.</p>
<p>Hasta ahora, vamos bien, todo dividido en módulos y así arquitectamos nuestros sistemas
por un largo tiempo, todo lo nuevo que hacemos, lo encapsulamos en un módulo aparte
que se puede importar, <em>y vio Dios que era bueno</em>, entonces nos permitió seguirlo
haciendo así.</p>
<div class="section" id="construyendo-un-elefante">
<h2>Construyendo un elefante</h2>
<p>Si trabajamos mucho tiempo iterando sobre el mismo sistema, la tendencia
natural es que este crezca, entonces, la cantidad de módulos irá creciendo
cada vez más, así como también los recursos que consume y, si todo sale bien,
también crecerá el tráfico que tenemos que manejar, entonces, poco a poco
sólo un gran servidor se irá quedando corto, ¿cuál es la solución natural?,
escalar de manera horizontal y agregar más servidores corriendo detrás de un
balanceador de carga, pero recordemos que estamos corriendo un sistema enorme
con muchos módulos cargados en memoria, se necesita un servidor grande (y probablemente
caro) para levantar algo tan pesado.</p>
<p>Más allá de eso, empezamos a preguntarnos, ¿qué tanto se usa cada módulo?, por ejemplo,
tenemos un módulo de registro de usuarios pero, no todos los usuarios que van a nuestra
página, por ejemplo, necesitan registrarse, sin embargo, ese módulo está cargado N veces,
donde N es la cantidad de servidores que tengamos sosteniendo nuestro monolito que, además,
seguramente seguirá creciendo cada vez más.</p>
<p>Eso por un lado, por otro lado, por otro lado, cada vez que vamos a liberar un feature
nuevo, resolver un bug o simplemente cambiar un texto en una plantilla, tenemos que
hacer deploy de un sistema pesado en N servidores, algo que puede tardar bastante tiempo
y quizás causar <em>downtime</em> de algunos minutos, quizás perdiendo potenciales usuarios.</p>
<p>Además, poco a poco hacer cambios en un <em>codebase</em> tan grande, se vuelve doloroso, es difícil
de modificar, difícil de probar, difícil de escalar y, por lo tanto, difícil de mantener.</p>
</div>
<div class="section" id="trabajo-de-hormigas-ventajas">
<h2>¿Trabajo de hormigas?, ventajas</h2>
<p>¿Qué pasaría si cada módulo lo convertimos en un proyecto aparte?, sí, con su propio
servidor y todo, tendríamos varios servicios que hacen una sola cosa y, simplemente,
tendríamos que escribir clientes para esos servicios y utilizarlos cuando sea necesario
y en el orden que sea necesario, ¿qué ventajas tiene esto?</p>
<p>Por un lado, usamos servidores más pequeños y si, por ejemplo, los usuarios
están subiendo muchas fotos, simplemente escalamos el &quot;servicio de gestión de fotos&quot;
y listo, es decir, agregamos un nuevo servidor y eso debería soportar más tráfico.
No creamos una instancia nueva de un servidor enorme con, además, partes del sistema que
no está siendo usadas o que no están recibiendo tanto tráfico.</p>
<p>Por otro lado, es más fácil conseguir errores, si falla el servicio de pagos, sabemos que
algo está mal con ese servicio pues, la única manera de que algo llegue allí es a través
de la interfaz HTTP que este servicio expone. También agregar features nuevos se convierte
en una tarea fácil, no hay que modificar un proyecto enorme sino quizás agregar un servicio
nuevo e integrarlo. Resolver bugs se convierte también en una tarea más fácil pues ya sabemos
dónde está fallando y, a la hora de hacer un release, si hay <em>downtime</em> es sólo un servicio
y los usuarios prefieren un <em>En este momento no es posible completar tu solicitud, intenta
en unos minutos</em> que un <em>En este momento estamos en mantenimiento, regresa luego</em>, al menos
pueden seguir usando las otras partes del sistema, ¿no?.</p>
<p>Finalmente, permite que la plataforma sea políglota, es decir, si tienes todo hecho en
Ruby on Rails, por ejemplo, pero quieres tener el motor de búsqueda con tecnologías de Web Semántica
y, la mejor herramienta que conseguiste fue integrar <a class="reference external" href="https://jena.apache.org/">Jena</a> con <a class="reference external" href="http://clarkparsia.com/pellet/">Pellet</a> como motor de
inferencia y todo eso está en <em>Java</em>, simplemente es un servicio más que expondrá unas interfaces
para que el resto pueda usarlo, así que realmente no importa en qué esté escrito.</p>
</div>
<div class="section" id="no-todo-es-perfecto">
<h2>No todo es perfecto</h2>
<p>Como todo en software, no hay balas de plata para matar problemas, cada solución tiene
también sus contra, algunos de los que he podido ver son los siguientes:</p>
<ul class="simple">
<li>Un request del usuario puede derivar en 50 o 60 requests internos a servicios,
por lo que la velocidad de respuesta se aprecia, hay que tener en caché lo que
se pueda e invalidar ese caché oportunamente para actualizarlo cuando sea necesario.</li>
<li>Cuando el equipo es muy grande, no todos los desarrolladores conocen todos los servicios,
siempre hay unos que saben más que otros y otros que saben mucho de algunos y nada de otros,
es difícil mantener homogeneidad en el conocimiento acerca de todo el stack.</li>
<li>Si un servicio no responde por alguna razón y las interfaces de los servicios son HTTP, ese
request se pierde, por lo tanto no tendremos esos datos en el servicio que corresponda, así
que si nuestro enfoque es optimista, el servicio que envió el request está contando con que todo
salió bien, hay que pensar entonces en algún método que permita reintentar o, si falla la solicitud,
tener un método de <em>fallback</em> para estos casos, quizás una cola para que el otro servicio empiece
a procesar cuando se despierte o, quizás, cambiar las llamadas HTTP por colas compartidas.</li>
<li>Las complicaciones de tener múltiples servidores tras un balanceador de carga se multiplican
por el número de servicios que tengamos.</li>
</ul>
</div>
<div class="section" id="buenas-practicas">
<h2>Buenas prácticas</h2>
<p>Aplica todo lo que ya sabemos, pero hay que ser un poco más rigurosos.</p>
<ul class="simple">
<li><strong>Documentación:</strong> además del código, hay que documentar la API que expone el servicio
que escribimos.</li>
<li><strong>Tolerancia a fallos:</strong> además de servidores redundantes, es necesario tener un método
de recuperación de datos en caso que falle algún servicio y algo no llegue a la base de datos.</li>
<li><strong>Pruebas:</strong> probar cada servicio es fácil, un set de pruebas unitarias hace el trabajo bastante
bien, la cosa se pone un poco más difícil con la pruebas de integración, es necesario contar
con los servicios con los que se va a interactuar a la hora de ejecutar estas pruebas.</li>
<li><strong>Deploy:</strong> se hace vital contar con un sistema de integración continua, de otra manera
todo se nos puede salir de las manos y se vuelve poco mantenible.</li>
<li><strong>Monitoreo:</strong> es necesario monitorear todos los servicios para conocer dónde están los cuellos
de botella y optimizar lo que sea necesario o tomar acciones para solventarlo. Además de saber cuándo
un servicio está caído antes de que los usuarios empiecen a quejarse.</li>
</ul>
<p>Como todo, el nirvana no es solamente orientado a servicios, hay muchas otras maneras de arquitectar
sistemas y todas son correctas dependiendo de las condiciones y el contexto que las rodean.</p>
<p>Acá dejo <a class="reference external" href="http://queue.acm.org/detail.cfm?id=1142065">una entrevista</a> a uno de mis héroes personales sobre este tema, Werner Vogels, CEO de Amazon.</p>
</div>


<div class="article-footer">
    <p><span class="glyphicon glyphicon-tag" aria-hidden="true"></span> <a href="tag/desarrollo.html">desarrollo</a> <a href="tag/servicios.html">servicios</a> <a href="tag/soa.html">soa</a> <a href="tag/web.html">web</a> </p>

    <p>Thank you for reading!, don't forget to subscribe to my mailing list!, I don't send any spam and sometimes I do share interesting stuff</p>


<!-- Begin MailChimp Signup Form -->
    <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
        /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
           We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
    </style>
    <div id="mc_embed_signup">
    <form action="//iferminmontilla.us11.list-manage.com/subscribe/post?u=0d4b15ef6a90baa460d821dbc&amp;id=8b51ac80b2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
        
    <div class="mc-field-group">
        <label for="mce-EMAIL">Email Address </label>
        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
    </div>
        <div id="mce-responses" class="clear">
            <div class="response" id="mce-error-response" style="display:none"></div>
            <div class="response" id="mce-success-response" style="display:none"></div>
        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_0d4b15ef6a90baa460d821dbc_8b51ac80b2" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
        </div>
    </form>
    </div>
    <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
    <!--End mc_embed_signup-->


</div>

            </div>
        </div>
    </div>
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-8">
                    Created by <a href="http://iferminmontilla.com">Israel Fermín Montilla</a> using <a href="http://getpelican.com" target="_blank">Pelican</a> and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>.
                    All content here is under <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US" target="_blank">Attribution-ShareAlike 3.0 Unported</a> license. Logo designed by <a href="https://about.me/andresfermin" target="_blank">Andrés Fermín</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
           (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-55459920-1', 'auto');
       ga('send', 'pageview');
    </script>
</body>
</html>
